{
  "version": 3,
  "sources": ["../../ws/browser.js", "browser-external:util", "browser-external:events", "browser-external:child_process", "../../node-rtsp-stream/mpeg1muxer.js", "../../node-rtsp-stream/videoStream.js", "../../node-rtsp-stream/index.js"],
  "sourcesContent": ["'use strict';\n\nmodule.exports = function () {\n  throw new Error(\n    'ws does not work in the browser. Browser clients must use the native ' +\n      'WebSocket object'\n  );\n};\n", "module.exports = Object.create(new Proxy({}, {\n  get(_, key) {\n    if (\n      key !== '__esModule' &&\n      key !== '__proto__' &&\n      key !== 'constructor' &&\n      key !== 'splice'\n    ) {\n      console.warn(`Module \"util\" has been externalized for browser compatibility. Cannot access \"util.${key}\" in client code. See http://vitejs.dev/guide/troubleshooting.html#module-externalized-for-browser-compatibility for more details.`)\n    }\n  }\n}))", "module.exports = Object.create(new Proxy({}, {\n  get(_, key) {\n    if (\n      key !== '__esModule' &&\n      key !== '__proto__' &&\n      key !== 'constructor' &&\n      key !== 'splice'\n    ) {\n      console.warn(`Module \"events\" has been externalized for browser compatibility. Cannot access \"events.${key}\" in client code. See http://vitejs.dev/guide/troubleshooting.html#module-externalized-for-browser-compatibility for more details.`)\n    }\n  }\n}))", "module.exports = Object.create(new Proxy({}, {\n  get(_, key) {\n    if (\n      key !== '__esModule' &&\n      key !== '__proto__' &&\n      key !== 'constructor' &&\n      key !== 'splice'\n    ) {\n      console.warn(`Module \"child_process\" has been externalized for browser compatibility. Cannot access \"child_process.${key}\" in client code. See http://vitejs.dev/guide/troubleshooting.html#module-externalized-for-browser-compatibility for more details.`)\n    }\n  }\n}))", "var Mpeg1Muxer, child_process, events, util\n\nchild_process = require('child_process')\n\nutil = require('util')\n\nevents = require('events')\n\nMpeg1Muxer = function(options) {\n  var key\n  this.url = options.url\n  this.ffmpegOptions = options.ffmpegOptions\n  this.exitCode = undefined\n  this.additionalFlags = []\n  if (this.ffmpegOptions) {\n    for (key in this.ffmpegOptions) {\n      this.additionalFlags.push(key)\n      if (String(this.ffmpegOptions[key]) !== '') {\n        this.additionalFlags.push(String(this.ffmpegOptions[key]))\n      }\n    }\n  }\n  this.spawnOptions = [\n    \"-i\",\n    this.url,\n    '-f',\n    'mpegts',\n    '-codec:v',\n    'mpeg1video',\n    // additional ffmpeg options go here\n    ...this.additionalFlags,\n    '-'\n  ]\n  this.stream = child_process.spawn(options.ffmpegPath, this.spawnOptions, {\n    detached: false\n  })\n  this.inputStreamStarted = true\n  this.stream.stdout.on('data', (data) => {\n    return this.emit('mpeg1data', data)\n  })\n  this.stream.stderr.on('data', (data) => {\n    return this.emit('ffmpegStderr', data)\n  })\n  this.stream.on('exit', (code, signal) => {\n    if (code === 1) {\n      console.error('RTSP stream exited with error')\n      this.exitCode = 1\n      return this.emit('exitWithError')\n    }\n  })\n  return this\n}\n\nutil.inherits(Mpeg1Muxer, events.EventEmitter)\n\nmodule.exports = Mpeg1Muxer\n", "var Mpeg1Muxer, STREAM_MAGIC_BYTES, VideoStream, events, util, ws\n\nws = require('ws')\n\nutil = require('util')\n\nevents = require('events')\n\nMpeg1Muxer = require('./mpeg1muxer')\n\nSTREAM_MAGIC_BYTES = \"jsmp\" // Must be 4 bytes\n\nVideoStream = function(options) {\n  this.options = options\n  this.name = options.name\n  this.streamUrl = options.streamUrl\n  this.width = options.width\n  this.height = options.height\n  this.wsPort = options.wsPort\n  this.inputStreamStarted = false\n  this.stream = undefined\n  this.startMpeg1Stream()\n  this.pipeStreamToSocketServer()\n  return this\n}\n\nutil.inherits(VideoStream, events.EventEmitter)\n\nVideoStream.prototype.stop = function() {\n  this.wsServer.close()\n  this.stream.kill()\n  this.inputStreamStarted = false\n  return this\n}\n\nVideoStream.prototype.startMpeg1Stream = function() {\n  var gettingInputData, gettingOutputData, inputData, outputData\n  this.mpeg1Muxer = new Mpeg1Muxer({\n    ffmpegOptions: this.options.ffmpegOptions,\n    url: this.streamUrl,\n    ffmpegPath: this.options.ffmpegPath == undefined ? \"ffmpeg\" : this.options.ffmpegPath\n  })\n  this.stream = this.mpeg1Muxer.stream\n  if (this.inputStreamStarted) {\n    return\n  }\n  this.mpeg1Muxer.on('mpeg1data', (data) => {\n    return this.emit('camdata', data)\n  })\n  gettingInputData = false\n  inputData = []\n  gettingOutputData = false\n  outputData = []\n  this.mpeg1Muxer.on('ffmpegStderr', (data) => {\n    var size\n    data = data.toString()\n    if (data.indexOf('Input #') !== -1) {\n      gettingInputData = true\n    }\n    if (data.indexOf('Output #') !== -1) {\n      gettingInputData = false\n      gettingOutputData = true\n    }\n    if (data.indexOf('frame') === 0) {\n      gettingOutputData = false\n    }\n    if (gettingInputData) {\n      inputData.push(data.toString())\n      size = data.match(/\\d+x\\d+/)\n      if (size != null) {\n        size = size[0].split('x')\n        if (this.width == null) {\n          this.width = parseInt(size[0], 10)\n        }\n        if (this.height == null) {\n          return this.height = parseInt(size[1], 10)\n        }\n      }\n    }\n  })\n  this.mpeg1Muxer.on('ffmpegStderr', function(data) {\n    return global.process.stderr.write(data)\n  })\n  this.mpeg1Muxer.on('exitWithError', () => {\n    return this.emit('exitWithError')\n  })\n  return this\n}\n\nVideoStream.prototype.pipeStreamToSocketServer = function() {\n  this.wsServer = new ws.Server({\n    port: this.wsPort\n  })\n  this.wsServer.on(\"connection\", (socket, request) => {\n    return this.onSocketConnect(socket, request)\n  })\n  this.wsServer.broadcast = function(data, opts) {\n    var results\n    results = []\n    for (let client of this.clients) {\n      if (client.readyState === 1) {\n        results.push(client.send(data, opts))\n      } else {\n        results.push(console.log(\"Error: Client from remoteAddress \" + client.remoteAddress + \" not connected.\"))\n      }\n    }\n    return results\n  }\n  return this.on('camdata', (data) => {\n    return this.wsServer.broadcast(data)\n  })\n}\n\nVideoStream.prototype.onSocketConnect = function(socket, request) {\n  var streamHeader\n  // Send magic bytes and video size to the newly connected socket\n  // struct { char magic[4]; unsigned short width, height;}\n  streamHeader = new Buffer(8)\n  streamHeader.write(STREAM_MAGIC_BYTES)\n  streamHeader.writeUInt16BE(this.width, 4)\n  streamHeader.writeUInt16BE(this.height, 6)\n  socket.send(streamHeader, {\n    binary: true\n  })\n  console.log(`${this.name}: New WebSocket Connection (` + this.wsServer.clients.size + \" total)\")\n\n  socket.remoteAddress = request.connection.remoteAddress\n\n  return socket.on(\"close\", (code, message) => {\n    return console.log(`${this.name}: Disconnected WebSocket (` + this.wsServer.clients.size + \" total)\")\n  })\n}\n\nmodule.exports = VideoStream", "module.exports = require('./videoStream')"],
  "mappings": "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",
  "names": []
}
